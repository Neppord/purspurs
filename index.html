<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Try it out</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #f5f5f5;
            color: #3a3a5f;
        }
        #code-label, #code, #code:focus, #code:focus-visible, #code:focus-within {
            font-family: 'JetBrains Mono', monospace;            background-color: #f5f5f5;
            color: #3a3a5f;
            white-space: pre-wrap;
            border: none;
            box-shadow: none;
            outline: none;
        }
        #output {
            white-space: pre-wrap;
            font-family: 'JetBrains Mono', monospace;
            margin-bottom: 0;
        }
    </style>
</head>
<body>
<form id="form">
    <output id="output"></output>
    <label id="code-label" for="code">>>> <input id="code" type="text" autocomplete="off" autofocus/></label>
</form>
<script type="module">
    import * as Interpreter from "./index.js";

    let env = Interpreter.default_env

    const output = document.getElementById("output");
    const code = document.getElementById("code");

    document.getElementById("code").addEventListener('keydown', function (event) {
        if (event.key === "Enter" && event.ctrlKey) {
            repl()
        }
    });

    function repl() {
        env = Interpreter.evaluate(code.value)(env)
        const tail = ">>> " + code.value + "\n" + Interpreter.print(env) + "\n"
        output.innerText = output.innerText + tail
        code.value = ""
    }

    document.getElementById("form").addEventListener("submit", (event) => {
        event.preventDefault()
        repl();
    })
</script>
</body>
</html>